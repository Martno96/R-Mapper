{"ast":null,"code":"import _ from 'lodash';\nimport $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\nexport const addClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n      _className = config.classNamePrefix + _className;\n    }\n\n    return _className;\n  }).join(' ');\n};\nexport const removeClassNamePrefix = function (className) {\n  if (!className) return className;\n  return className.toString().split(' ').map(function (_className) {\n    if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n      _className = _className.substr(config.classNamePrefix.length);\n    }\n\n    return _className;\n  }).join(' ');\n};\nexport const parseDOMJSON = function (json, namespace) {\n  var selectors = {};\n  var groupSelectors = {};\n  var svgNamespace = V.namespace.svg;\n  var ns = namespace || svgNamespace;\n  var fragment = document.createDocumentFragment();\n  var queue = [json, fragment, ns];\n\n  while (queue.length > 0) {\n    ns = queue.pop();\n    var parentNode = queue.pop();\n    var siblingsDef = queue.pop();\n\n    for (var i = 0, n = siblingsDef.length; i < n; i++) {\n      var nodeDef = siblingsDef[i]; // TagName\n\n      if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n      var tagName = nodeDef.tagName; // Namespace URI\n\n      if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n      var node = document.createElementNS(ns, tagName);\n      var svg = ns === svgNamespace;\n      var wrapper = svg ? V : $; // Attributes\n\n      var attributes = nodeDef.attributes;\n      if (attributes) wrapper(node).attr(attributes); // Style\n\n      var style = nodeDef.style;\n      if (style) $(node).css(style); // ClassName\n\n      if (nodeDef.hasOwnProperty('className')) {\n        var className = nodeDef.className;\n\n        if (svg) {\n          node.className.baseVal = className;\n        } else {\n          node.className = className;\n        }\n      } // TextContent\n\n\n      if (nodeDef.hasOwnProperty('textContent')) {\n        node.textContent = nodeDef.textContent;\n      } // Selector\n\n\n      if (nodeDef.hasOwnProperty('selector')) {\n        var nodeSelector = nodeDef.selector;\n        if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n        selectors[nodeSelector] = node;\n        wrapper(node).attr('joint-selector', nodeSelector);\n      } // Groups\n\n\n      if (nodeDef.hasOwnProperty('groupSelector')) {\n        var nodeGroups = nodeDef.groupSelector;\n        if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n\n        for (var j = 0, m = nodeGroups.length; j < m; j++) {\n          var nodeGroup = nodeGroups[j];\n          var group = groupSelectors[nodeGroup];\n          if (!group) group = groupSelectors[nodeGroup] = [];\n          group.push(node);\n        }\n      }\n\n      parentNode.appendChild(node); // Children\n\n      var childrenDef = nodeDef.children;\n      if (Array.isArray(childrenDef)) queue.push(childrenDef, node, ns);\n    }\n  }\n\n  return {\n    fragment: fragment,\n    selectors: selectors,\n    groupSelectors: groupSelectors\n  };\n}; // Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\n\nexport const hashCode = function (str) {\n  let hash = 0;\n  if (str.length === 0) return hash;\n\n  for (let i = 0; i < str.length; i++) {\n    const c = str.charCodeAt(i);\n    hash = (hash << 5) - hash + c;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  return hash;\n};\nexport const getByPath = function (obj, path, delimiter) {\n  var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  var key;\n  var i = 0;\n  var length = keys.length;\n\n  while (i < length) {\n    key = keys[i++];\n\n    if (Object(obj) === obj && key in obj) {\n      obj = obj[key];\n    } else {\n      return undefined;\n    }\n  }\n\n  return obj;\n};\n\nconst isGetSafe = function (obj, key) {\n  // Prevent prototype pollution\n  // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n  if (key === 'constructor' && typeof obj[key] === 'function') {\n    return false;\n  }\n\n  if (key === '__proto__') {\n    return false;\n  }\n\n  return true;\n};\n\nexport const setByPath = function (obj, path, value, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key]; // diver creates an empty object if there is no nested object under such a key.\n    // This means that one can populate an empty nested object with setByPath().\n\n    diver = value || (diver[key] = {});\n  }\n\n  diver[keys[last]] = value;\n  return obj;\n};\nexport const unsetByPath = function (obj, path, delimiter) {\n  const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n  const last = keys.length - 1;\n  let diver = obj;\n  let i = 0;\n\n  for (; i < last; i++) {\n    const key = keys[i];\n    if (!isGetSafe(diver, key)) return obj;\n    const value = diver[key];\n    if (!value) return obj;\n    diver = value;\n  }\n\n  delete diver[keys[last]];\n  return obj;\n};\nexport const flattenObject = function (obj, delim, stop) {\n  delim = delim || '/';\n  var ret = {};\n\n  for (var key in obj) {\n    if (!obj.hasOwnProperty(key)) continue;\n    var shouldGoDeeper = typeof obj[key] === 'object';\n\n    if (shouldGoDeeper && stop && stop(obj[key])) {\n      shouldGoDeeper = false;\n    }\n\n    if (shouldGoDeeper) {\n      var flatObject = flattenObject(obj[key], delim, stop);\n\n      for (var flatKey in flatObject) {\n        if (!flatObject.hasOwnProperty(flatKey)) continue;\n        ret[key + delim + flatKey] = flatObject[flatKey];\n      }\n    } else {\n      ret[key] = obj[key];\n    }\n  }\n\n  return ret;\n};\nexport const uuid = function () {\n  // credit: http://stackoverflow.com/posts/2117523/revisions\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0;\n    var v = c === 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}; // Generate global unique id for obj and store it as a property of the object.\n\nexport const guid = function (obj) {\n  guid.id = guid.id || 1;\n  obj.id = obj.id === undefined ? 'j_' + guid.id++ : obj.id;\n  return obj.id;\n};\nexport const toKebabCase = function (string) {\n  return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\nexport const normalizeEvent = function (evt) {\n  var normalizedEvent = evt;\n  var touchEvt = evt.originalEvent && evt.originalEvent.changedTouches && evt.originalEvent.changedTouches[0];\n\n  if (touchEvt) {\n    for (var property in evt) {\n      // copy all the properties from the input event that are not\n      // defined on the touch event (functions included).\n      if (touchEvt[property] === undefined) {\n        touchEvt[property] = evt[property];\n      }\n    }\n\n    normalizedEvent = touchEvt;\n  } // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n\n\n  var target = normalizedEvent.target;\n\n  if (target) {\n    var useElement = target.correspondingUseElement;\n    if (useElement) normalizedEvent.target = useElement;\n  }\n\n  return normalizedEvent;\n};\nexport const nextFrame = function () {\n  var raf;\n\n  if (typeof window !== 'undefined') {\n    raf = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame;\n  }\n\n  if (!raf) {\n    var lastTime = 0;\n\n    raf = function (callback) {\n      var currTime = new Date().getTime();\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n      var id = setTimeout(function () {\n        callback(currTime + timeToCall);\n      }, timeToCall);\n      lastTime = currTime + timeToCall;\n      return id;\n    };\n  }\n\n  return function (callback, context, ...rest) {\n    return context !== undefined ? raf(callback.bind(context, ...rest)) : raf(callback);\n  };\n}();\nexport const cancelFrame = function () {\n  var caf;\n  var client = typeof window != 'undefined';\n\n  if (client) {\n    caf = window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.msCancelRequestAnimationFrame || window.oCancelAnimationFrame || window.oCancelRequestAnimationFrame || window.mozCancelAnimationFrame || window.mozCancelRequestAnimationFrame;\n  }\n\n  caf = caf || clearTimeout;\n  return client ? caf.bind(window) : caf;\n}();\n/**\n * @deprecated\n */\n\nexport const shapePerimeterConnectionPoint = function (linkView, view, magnet, reference) {\n  var bbox;\n  var spot;\n\n  if (!magnet) {\n    // There is no magnet, try to make the best guess what is the\n    // wrapping SVG element. This is because we want this \"smart\"\n    // connection points to work out of the box without the\n    // programmer to put magnet marks to any of the subelements.\n    // For example, we want the function to work on basic.Path elements\n    // without any special treatment of such elements.\n    // The code below guesses the wrapping element based on\n    // one simple assumption. The wrapping elemnet is the\n    // first child of the scalable group if such a group exists\n    // or the first child of the rotatable group if not.\n    // This makese sense because usually the wrapping element\n    // is below any other sub element in the shapes.\n    var scalable = view.$('.scalable')[0];\n    var rotatable = view.$('.rotatable')[0];\n\n    if (scalable && scalable.firstChild) {\n      magnet = scalable.firstChild;\n    } else if (rotatable && rotatable.firstChild) {\n      magnet = rotatable.firstChild;\n    }\n  }\n\n  if (magnet) {\n    spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n\n    if (!spot) {\n      bbox = V(magnet).getBBox({\n        target: linkView.paper.cells\n      });\n    }\n  } else {\n    bbox = view.model.getBBox();\n    spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n  }\n\n  return spot || bbox.center();\n};\nexport const isPercentage = function (val) {\n  return isString(val) && val.slice(-1) === '%';\n};\nexport const parseCssNumeric = function (val, restrictUnits) {\n  function getUnit(validUnitExp) {\n    // one or more numbers, followed by\n    // any number of (\n    //  `.`, followed by\n    //  one or more numbers\n    // ), followed by\n    // `validUnitExp`, followed by\n    // end of string\n    var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n    if (!matches) return null;\n    return matches[1];\n  }\n\n  var number = parseFloat(val); // if `val` cannot be parsed as a number, return `null`\n\n  if (Number.isNaN(number)) return null; // else: we know `output.value`\n\n  var output = {};\n  output.value = number; // determine the unit\n\n  var validUnitExp;\n\n  if (restrictUnits == null) {\n    // no restriction\n    // accept any unit, as well as no unit\n    validUnitExp = '[A-Za-z]*';\n  } else if (Array.isArray(restrictUnits)) {\n    // if this is an empty array, top restriction - return `null`\n    if (restrictUnits.length === 0) return null; // else: restriction - an array of valid unit strings\n\n    validUnitExp = restrictUnits.join('|');\n  } else if (isString(restrictUnits)) {\n    // restriction - a single valid unit string\n    validUnitExp = restrictUnits;\n  }\n\n  var unit = getUnit(validUnitExp); // if we found no matches for `restrictUnits`, return `null`\n\n  if (unit === null) return null; // else: we know the unit\n\n  output.unit = unit;\n  return output;\n};\nexport const breakText = function (text, size, styles = {}, opt = {}) {\n  var width = size.width;\n  var height = size.height;\n  var svgDocument = opt.svgDocument || V('svg').node;\n  var textSpan = V('tspan').node;\n  var textElement = V('text').attr(styles).append(textSpan).node;\n  var textNode = document.createTextNode(''); // Prevent flickering\n\n  textElement.style.opacity = 0; // Prevent FF from throwing an uncaught exception when `getBBox()`\n  // called on element that is not in the render tree (is not measurable).\n  // <tspan>.getComputedTextLength() returns always 0 in this case.\n  // Note that the `textElement` resp. `textSpan` can become hidden\n  // when it's appended to the DOM and a `display: none` CSS stylesheet\n  // rule gets applied.\n\n  textElement.style.display = 'block';\n  textSpan.style.display = 'block';\n  textSpan.appendChild(textNode);\n  svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n  if (!opt.svgDocument) {\n    document.body.appendChild(svgDocument);\n  }\n\n  var separator = opt.separator || ' ';\n  var eol = opt.eol || '\\n';\n  var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n  var maxLineCount = opt.maxLineCount;\n  if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n  var words = text.split(separator);\n  var full = [];\n  var lines = [];\n  var p, h;\n  var lineHeight;\n\n  for (var i = 0, l = 0, len = words.length; i < len; i++) {\n    var word = words[i];\n    if (!word) continue;\n    var isEol = false;\n\n    if (eol && word.indexOf(eol) >= 0) {\n      // word contains end-of-line character\n      if (word.length > 1) {\n        // separate word and continue cycle\n        var eolWords = word.split(eol);\n\n        for (var j = 0, jl = eolWords.length - 1; j < jl; j++) {\n          eolWords.splice(2 * j + 1, 0, eol);\n        }\n\n        words.splice(i, 1, ...eolWords.filter(word => word !== ''));\n        i--;\n        len = words.length;\n        continue;\n      } else {\n        // creates a new line\n        lines[++l] = '';\n        isEol = true;\n      }\n    }\n\n    if (!isEol) {\n      textNode.data = lines[l] ? lines[l] + ' ' + word : word;\n\n      if (textSpan.getComputedTextLength() <= width) {\n        // the current line fits\n        lines[l] = textNode.data;\n\n        if (p || h) {\n          // We were partitioning. Put rest of the word onto next line\n          full[l++] = true; // cancel partitioning and splitting by hyphens\n\n          p = 0;\n          h = 0;\n        }\n      } else {\n        if (!lines[l] || p) {\n          var partition = !!p;\n          p = word.length - 1;\n\n          if (partition || !p) {\n            // word has only one character.\n            if (!p) {\n              if (!lines[l]) {\n                // we won't fit this text within our rect\n                lines = [];\n                break;\n              } // partitioning didn't help on the non-empty line\n              // try again, but this time start with a new line\n              // cancel partitions created\n\n\n              words.splice(i, 2, word + words[i + 1]); // adjust word length\n\n              len--;\n              full[l++] = true;\n              i--;\n              continue;\n            } // move last letter to the beginning of the next word\n\n\n            words[i] = word.substring(0, p);\n            words[i + 1] = word.substring(p) + words[i + 1];\n          } else {\n            if (h) {\n              // cancel splitting and put the words together again\n              words.splice(i, 2, words[i] + words[i + 1]);\n              h = 0;\n            } else {\n              var hyphenIndex = word.search(hyphen);\n\n              if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                h = hyphenIndex + 1;\n                p = 0;\n              } // We initiate partitioning or splitting\n              // split the long word into two words\n\n\n              words.splice(i, 1, word.substring(0, h || p), word.substring(h || p)); // adjust words length\n\n              len++;\n            }\n\n            if (l && !full[l - 1]) {\n              // if the previous line is not full, try to fit max part of\n              // the current word there\n              l--;\n            }\n          }\n\n          i--;\n          continue;\n        }\n\n        l++;\n        i--;\n      }\n    }\n\n    var lastL = null;\n\n    if (lines.length > maxLineCount) {\n      lastL = maxLineCount - 1;\n    } else if (height !== undefined) {\n      // if size.height is defined we have to check whether the height of the entire\n      // text exceeds the rect height\n      if (lineHeight === undefined) {\n        var heightValue; // use the same defaults as in V.prototype.text\n\n        if (styles.lineHeight === 'auto') {\n          heightValue = {\n            value: 1.5,\n            unit: 'em'\n          };\n        } else {\n          heightValue = parseCssNumeric(styles.lineHeight, ['em']) || {\n            value: 1,\n            unit: 'em'\n          };\n        }\n\n        lineHeight = heightValue.value;\n\n        if (heightValue.unit === 'em') {\n          lineHeight *= textElement.getBBox().height;\n        }\n      }\n\n      if (lineHeight * lines.length > height) {\n        // remove overflowing lines\n        lastL = Math.floor(height / lineHeight) - 1;\n      }\n    }\n\n    if (lastL !== null) {\n      lines.splice(lastL + 1); // add ellipsis\n\n      var ellipsis = opt.ellipsis;\n      if (!ellipsis || lastL < 0) break;\n      if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n      var lastLine = lines[lastL];\n      if (!lastLine && !isEol) break;\n      var k = lastLine.length;\n      var lastLineWithOmission, lastChar, separatorChar;\n\n      do {\n        lastChar = lastLine[k];\n        lastLineWithOmission = lastLine.substring(0, k);\n\n        if (!lastChar) {\n          separatorChar = typeof separator === 'string' ? separator : ' ';\n          lastLineWithOmission += separatorChar;\n        } else if (lastChar.match(separator)) {\n          lastLineWithOmission += lastChar;\n        }\n\n        lastLineWithOmission += ellipsis;\n        textNode.data = lastLineWithOmission;\n\n        if (textSpan.getComputedTextLength() <= width) {\n          lines[lastL] = lastLineWithOmission;\n          break;\n        }\n\n        k--;\n      } while (k >= 0);\n\n      break;\n    }\n  }\n\n  if (opt.svgDocument) {\n    // svg document was provided, remove the text element only\n    svgDocument.removeChild(textElement);\n  } else {\n    // clean svg document\n    document.body.removeChild(svgDocument);\n  }\n\n  return lines.join(eol);\n}; // Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\n\nexport const sanitizeHTML = function (html) {\n  // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n  // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n  // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n  // If keepScripts (last parameter) is `false`, scripts are not executed.\n  var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n  output.find('*').each(function () {\n    // for all nodes\n    var currentNode = this;\n    $.each(currentNode.attributes, function () {\n      // for all attributes in each node\n      var currentAttribute = this;\n      var attrName = currentAttribute.name;\n      var attrValue = currentAttribute.value; // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n      // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n\n      if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n        $(currentNode).removeAttr(attrName);\n      }\n    });\n  });\n  return output.html();\n}; // Download `blob` as file with `fileName`.\n// Does not work in IE9.\n\nexport const downloadBlob = function (blob, fileName) {\n  if (window.navigator.msSaveBlob) {\n    // requires IE 10+\n    // pulls up a save dialog\n    window.navigator.msSaveBlob(blob, fileName);\n  } else {\n    // other browsers\n    // downloads directly in Chrome and Safari\n    // presents a save/open dialog in Firefox\n    // Firefox bug: `from` field in save dialog always shows `from:blob:`\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n    var url = window.URL.createObjectURL(blob);\n    var link = document.createElement('a');\n    link.href = url;\n    link.download = fileName;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    window.URL.revokeObjectURL(url); // mark the url for garbage collection\n  }\n}; // Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\n\nexport const downloadDataUri = function (dataUri, fileName) {\n  const blob = dataUriToBlob(dataUri);\n  downloadBlob(blob, fileName);\n}; // Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\n\nexport const dataUriToBlob = function (dataUri) {\n  // first, make sure there are no newlines in the data uri\n  dataUri = dataUri.replace(/\\s/g, '');\n  dataUri = decodeURIComponent(dataUri);\n  var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n  var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n\n  var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n  var data = dataUri.slice(firstCommaIndex + 1);\n  var decodedString;\n\n  if (dataTypeString.indexOf('base64') >= 0) {\n    // data may be encoded in base64\n    decodedString = atob(data); // decode data\n  } else {\n    // convert the decoded string to UTF-8\n    decodedString = unescape(encodeURIComponent(data));\n  } // write the bytes of the string to a typed array\n\n\n  var ia = new Uint8Array(decodedString.length);\n\n  for (var i = 0; i < decodedString.length; i++) {\n    ia[i] = decodedString.charCodeAt(i);\n  }\n\n  return new Blob([ia], {\n    type: mimeString\n  }); // return the typed array as Blob\n}; // Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\n\nexport const imageToDataUri = function (url, callback) {\n  if (!url || url.substr(0, 'data:'.length) === 'data:') {\n    // No need to convert to data uri if it is already in data uri.\n    // This not only convenient but desired. For example,\n    // IE throws a security error if data:image/svg+xml is used to render\n    // an image to the canvas and an attempt is made to read out data uri.\n    // Now if our image is already in data uri, there is no need to render it to the canvas\n    // and so we can bypass this error.\n    // Keep the async nature of the function.\n    return setTimeout(function () {\n      callback(null, url);\n    }, 0);\n  } // chrome, IE10+\n\n\n  var modernHandler = function (xhr, callback) {\n    if (xhr.status === 200) {\n      var reader = new FileReader();\n\n      reader.onload = function (evt) {\n        var dataUri = evt.target.result;\n        callback(null, dataUri);\n      };\n\n      reader.onerror = function () {\n        callback(new Error('Failed to load image ' + url));\n      };\n\n      reader.readAsDataURL(xhr.response);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n\n  var legacyHandler = function (xhr, callback) {\n    var Uint8ToString = function (u8a) {\n      var CHUNK_SZ = 0x8000;\n      var c = [];\n\n      for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n        c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n      }\n\n      return c.join('');\n    };\n\n    if (xhr.status === 200) {\n      var bytes = new Uint8Array(xhr.response);\n      var suffix = url.split('.').pop() || 'png';\n      var map = {\n        'svg': 'svg+xml'\n      };\n      var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n      var b64encoded = meta + btoa(Uint8ToString(bytes));\n      callback(null, b64encoded);\n    } else {\n      callback(new Error('Failed to load image ' + url));\n    }\n  };\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', url, true);\n  xhr.addEventListener('error', function () {\n    callback(new Error('Failed to load image ' + url));\n  });\n  xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n  xhr.addEventListener('load', function () {\n    if (window.FileReader) {\n      modernHandler(xhr, callback);\n    } else {\n      legacyHandler(xhr, callback);\n    }\n  });\n  xhr.send();\n};\nexport const getElementBBox = function (el) {\n  var $el = $(el);\n\n  if ($el.length === 0) {\n    throw new Error('Element not found');\n  }\n\n  var element = $el[0];\n  var doc = element.ownerDocument;\n  var clientBBox = element.getBoundingClientRect();\n  var strokeWidthX = 0;\n  var strokeWidthY = 0; // Firefox correction\n\n  if (element.ownerSVGElement) {\n    var vel = V(element);\n    var bbox = vel.getBBox({\n      target: vel.svg()\n    }); // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n    // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n\n    strokeWidthX = clientBBox.width - bbox.width;\n    strokeWidthY = clientBBox.height - bbox.height;\n  }\n\n  return {\n    x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n    y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n    width: clientBBox.width - strokeWidthX,\n    height: clientBBox.height - strokeWidthY\n  };\n}; // Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\n\nexport const sortElements = function (elements, comparator) {\n  var $elements = $(elements);\n  var placements = $elements.map(function () {\n    var sortElement = this;\n    var parentNode = sortElement.parentNode; // Since the element itself will change position, we have\n    // to have some way of storing it's original position in\n    // the DOM. The easiest way is to have a 'flag' node:\n\n    var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n    return function () {\n      if (parentNode === this) {\n        throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n      } // Insert before flag:\n\n\n      parentNode.insertBefore(this, nextSibling); // Remove flag:\n\n      parentNode.removeChild(nextSibling);\n    };\n  });\n  return Array.prototype.sort.call($elements, comparator).each(function (i) {\n    placements[i].call(this);\n  });\n}; // Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\n\nexport const setAttributesBySelector = function (element, attrs) {\n  var $element = $(element);\n  forIn(attrs, function (attrs, selector) {\n    var $elements = $element.find(selector).addBack().filter(selector); // Make a special case for setting classes.\n    // We do not want to overwrite any existing class.\n\n    if (has(attrs, 'class')) {\n      $elements.addClass(attrs['class']);\n      attrs = omit(attrs, 'class');\n    }\n\n    $elements.attr(attrs);\n  });\n}; // Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n\nexport const normalizeSides = function (box) {\n  if (Object(box) !== box) {\n    // `box` is not an object\n    var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n\n    if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n    return {\n      top: val,\n      right: val,\n      bottom: val,\n      left: val\n    };\n  } // `box` is an object\n\n\n  var top, right, bottom, left;\n  top = right = bottom = left = 0;\n  if (isFinite(box.vertical)) top = bottom = +box.vertical;\n  if (isFinite(box.horizontal)) right = left = +box.horizontal;\n  if (isFinite(box.top)) top = +box.top; // overwrite vertical\n\n  if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n\n  if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n\n  if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n  return {\n    top: top,\n    right: right,\n    bottom: bottom,\n    left: left\n  };\n};\nexport const timing = {\n  linear: function (t) {\n    return t;\n  },\n  quad: function (t) {\n    return t * t;\n  },\n  cubic: function (t) {\n    return t * t * t;\n  },\n  inout: function (t) {\n    if (t <= 0) return 0;\n    if (t >= 1) return 1;\n    var t2 = t * t;\n    var t3 = t2 * t;\n    return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n  },\n  exponential: function (t) {\n    return Math.pow(2, 10 * (t - 1));\n  },\n  bounce: function (t) {\n    for (var a = 0, b = 1; 1; a += b, b /= 2) {\n      if (t >= (7 - 4 * a) / 11) {\n        var q = (11 - 6 * a - 11 * t) / 4;\n        return -q * q + b * b;\n      }\n    }\n  },\n  reverse: function (f) {\n    return function (t) {\n      return 1 - f(1 - t);\n    };\n  },\n  reflect: function (f) {\n    return function (t) {\n      return .5 * (t < .5 ? f(2 * t) : 2 - f(2 - 2 * t));\n    };\n  },\n  clamp: function (f, n, x) {\n    n = n || 0;\n    x = x || 1;\n    return function (t) {\n      var r = f(t);\n      return r < n ? n : r > x ? x : r;\n    };\n  },\n  back: function (s) {\n    if (!s) s = 1.70158;\n    return function (t) {\n      return t * t * ((s + 1) * t - s);\n    };\n  },\n  elastic: function (x) {\n    if (!x) x = 1.5;\n    return function (t) {\n      return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n    };\n  }\n};\nexport const interpolate = {\n  number: function (a, b) {\n    var d = b - a;\n    return function (t) {\n      return a + d * t;\n    };\n  },\n  object: function (a, b) {\n    var s = Object.keys(a);\n    return function (t) {\n      var i, p;\n      var r = {};\n\n      for (i = s.length - 1; i != -1; i--) {\n        p = s[i];\n        r[p] = a[p] + (b[p] - a[p]) * t;\n      }\n\n      return r;\n    };\n  },\n  hexColor: function (a, b) {\n    var ca = parseInt(a.slice(1), 16);\n    var cb = parseInt(b.slice(1), 16);\n    var ra = ca & 0x0000ff;\n    var rd = (cb & 0x0000ff) - ra;\n    var ga = ca & 0x00ff00;\n    var gd = (cb & 0x00ff00) - ga;\n    var ba = ca & 0xff0000;\n    var bd = (cb & 0xff0000) - ba;\n    return function (t) {\n      var r = ra + rd * t & 0x000000ff;\n      var g = ga + gd * t & 0x0000ff00;\n      var b = ba + bd * t & 0x00ff0000;\n      return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n    };\n  },\n  unit: function (a, b) {\n    var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n    var ma = r.exec(a);\n    var mb = r.exec(b);\n    var p = mb[1].indexOf('.');\n    var f = p > 0 ? mb[1].length - p - 1 : 0;\n    a = +ma[1];\n    var d = +mb[1] - a;\n    var u = ma[2];\n    return function (t) {\n      return (a + d * t).toFixed(f) + u;\n    };\n  }\n}; // SVG filters.\n// (values in parentheses are default values)\n\nexport const filter = {\n  // `color` ... outline color ('blue')\n  // `width`... outline width (1)\n  // `opacity` ... outline opacity (1)\n  // `margin` ... gap between outline and the element (2)\n  outline: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    var margin = Number.isFinite(args.margin) ? args.margin : 2;\n    var width = Number.isFinite(args.width) ? args.width : 1;\n    return template(tpl)({\n      color: args.color || 'blue',\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      outerRadius: margin + width,\n      innerRadius: margin\n    });\n  },\n  // `color` ... color ('red')\n  // `width`... width (1)\n  // `blur` ... blur (0)\n  // `opacity` ... opacity (1)\n  highlight: function (args) {\n    var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n    return template(tpl)({\n      color: args.color || 'red',\n      width: Number.isFinite(args.width) ? args.width : 1,\n      blur: Number.isFinite(args.blur) ? args.blur : 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n    });\n  },\n  // `x` ... horizontal blur (2)\n  // `y` ... vertical blur (optional)\n  blur: function (args) {\n    var x = Number.isFinite(args.x) ? args.x : 2;\n    return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n      stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n    });\n  },\n  // `dx` ... horizontal shift (0)\n  // `dy` ... vertical shift (0)\n  // `blur` ... blur (4)\n  // `color` ... color ('black')\n  // `opacity` ... opacity (1)\n  dropShadow: function (args) {\n    var tpl = 'SVGFEDropShadowElement' in window ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>' : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n    return template(tpl)({\n      dx: args.dx || 0,\n      dy: args.dy || 0,\n      opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n      color: args.color || 'black',\n      blur: Number.isFinite(args.blur) ? args.blur : 4\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n  grayscale: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.2126 + 0.7874 * (1 - amount),\n      b: 0.7152 - 0.7152 * (1 - amount),\n      c: 0.0722 - 0.0722 * (1 - amount),\n      d: 0.2126 - 0.2126 * (1 - amount),\n      e: 0.7152 + 0.2848 * (1 - amount),\n      f: 0.0722 - 0.0722 * (1 - amount),\n      g: 0.2126 - 0.2126 * (1 - amount),\n      h: 0.0722 + 0.9278 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n  sepia: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n      a: 0.393 + 0.607 * (1 - amount),\n      b: 0.769 - 0.769 * (1 - amount),\n      c: 0.189 - 0.189 * (1 - amount),\n      d: 0.349 - 0.349 * (1 - amount),\n      e: 0.686 + 0.314 * (1 - amount),\n      f: 0.168 - 0.168 * (1 - amount),\n      g: 0.272 - 0.272 * (1 - amount),\n      h: 0.534 - 0.534 * (1 - amount),\n      i: 0.131 + 0.869 * (1 - amount)\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n  saturate: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n      amount: 1 - amount\n    });\n  },\n  // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n  hueRotate: function (args) {\n    return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n      angle: args.angle || 0\n    });\n  },\n  // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n  invert: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: 1 - amount\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  brightness: function (args) {\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n      amount: Number.isFinite(args.amount) ? args.amount : 1\n    });\n  },\n  // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n  contrast: function (args) {\n    var amount = Number.isFinite(args.amount) ? args.amount : 1;\n    return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n      amount: amount,\n      amount2: .5 - amount / 2\n    });\n  }\n};\nexport const format = {\n  // Formatting numbers via the Python Format Specification Mini-language.\n  // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n  // Heavilly inspired by the D3.js library implementation.\n  number: function (specifier, value, locale) {\n    locale = locale || {\n      currency: ['$', ''],\n      decimal: '.',\n      thousands: ',',\n      grouping: [3]\n    }; // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // [[fill]align][sign][symbol][0][width][,][.precision][type]\n\n    var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n    var match = re.exec(specifier);\n    var fill = match[1] || ' ';\n    var align = match[2] || '>';\n    var sign = match[3] || '';\n    var symbol = match[4] || '';\n    var zfill = match[5];\n    var width = +match[6];\n    var comma = match[7];\n    var precision = match[8];\n    var type = match[9];\n    var scale = 1;\n    var prefix = '';\n    var suffix = '';\n    var integer = false;\n    if (precision) precision = +precision.substring(1);\n\n    if (zfill || fill === '0' && align === '=') {\n      zfill = fill = '0';\n      align = '=';\n      if (comma) width -= Math.floor((width - 1) / 4);\n    }\n\n    switch (type) {\n      case 'n':\n        comma = true;\n        type = 'g';\n        break;\n\n      case '%':\n        scale = 100;\n        suffix = '%';\n        type = 'f';\n        break;\n\n      case 'p':\n        scale = 100;\n        suffix = '%';\n        type = 'r';\n        break;\n\n      case 'b':\n      case 'o':\n      case 'x':\n      case 'X':\n        if (symbol === '#') prefix = '0' + type.toLowerCase();\n        break;\n\n      case 'c':\n      case 'd':\n        integer = true;\n        precision = 0;\n        break;\n\n      case 's':\n        scale = -1;\n        type = 'r';\n        break;\n    }\n\n    if (symbol === '$') {\n      prefix = locale.currency[0];\n      suffix = locale.currency[1];\n    } // If no precision is specified for `'r'`, fallback to general notation.\n\n\n    if (type == 'r' && !precision) type = 'g'; // Ensure that the requested precision is in the supported range.\n\n    if (precision != null) {\n      if (type == 'g') precision = Math.max(1, Math.min(21, precision));else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n    }\n\n    var zcomma = zfill && comma; // Return the empty string for floats formatted as ints.\n\n    if (integer && value % 1) return ''; // Convert negative to positive, and record the sign prefix.\n\n    var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n    var fullSuffix = suffix; // Apply the scale, computing it from the value's exponent for si format.\n    // Preserve the existing suffix, if any, such as the currency symbol.\n\n    if (scale < 0) {\n      var unit = this.prefix(value, precision);\n      value = unit.scale(value);\n      fullSuffix = unit.symbol + suffix;\n    } else {\n      value *= scale;\n    } // Convert to the desired precision.\n\n\n    value = this.convert(type, value, precision); // Break the value into the integer part (before) and decimal part (after).\n\n    var i = value.lastIndexOf('.');\n    var before = i < 0 ? value : value.substring(0, i);\n    var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n    function formatGroup(value) {\n      var i = value.length;\n      var t = [];\n      var j = 0;\n      var g = locale.grouping[0];\n\n      while (i > 0 && g > 0) {\n        t.push(value.substring(i -= g, i + g));\n        g = locale.grouping[j = (j + 1) % locale.grouping.length];\n      }\n\n      return t.reverse().join(locale.thousands);\n    } // If the fill character is not `'0'`, grouping is applied before padding.\n\n\n    if (!zfill && comma && locale.grouping) {\n      before = formatGroup(before);\n    }\n\n    var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n    var padding = length < width ? new Array(length = width - length + 1).join(fill) : ''; // If the fill character is `'0'`, grouping is applied after padding.\n\n    if (zcomma) before = formatGroup(padding + before); // Apply prefix.\n\n    negative += prefix; // Rejoin integer and decimal parts.\n\n    value = before + after;\n    return (align === '<' ? negative + value + padding : align === '>' ? padding + negative + value : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length) : negative + (zcomma ? value : padding + value)) + fullSuffix;\n  },\n  // Formatting string via the Python Format string.\n  // See https://docs.python.org/2/library/string.html#format-string-syntax)\n  string: function (formatString, value) {\n    var fieldDelimiterIndex;\n    var fieldDelimiter = '{';\n    var endPlaceholder = false;\n    var formattedStringArray = [];\n\n    while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n      var pieceFormattedString, formatSpec, fieldName;\n      pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n\n      if (endPlaceholder) {\n        formatSpec = pieceFormattedString.split(':');\n        fieldName = formatSpec.shift().split('.');\n        pieceFormattedString = value;\n\n        for (var i = 0; i < fieldName.length; i++) pieceFormattedString = pieceFormattedString[fieldName[i]];\n\n        if (formatSpec.length) pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n      }\n\n      formattedStringArray.push(pieceFormattedString);\n      formatString = formatString.slice(fieldDelimiterIndex + 1);\n      endPlaceholder = !endPlaceholder;\n      fieldDelimiter = endPlaceholder ? '}' : '{';\n    }\n\n    formattedStringArray.push(formatString);\n    return formattedStringArray.join('');\n  },\n  convert: function (type, value, precision) {\n    switch (type) {\n      case 'b':\n        return value.toString(2);\n\n      case 'c':\n        return String.fromCharCode(value);\n\n      case 'o':\n        return value.toString(8);\n\n      case 'x':\n        return value.toString(16);\n\n      case 'X':\n        return value.toString(16).toUpperCase();\n\n      case 'g':\n        return value.toPrecision(precision);\n\n      case 'e':\n        return value.toExponential(precision);\n\n      case 'f':\n        return value.toFixed(precision);\n\n      case 'r':\n        return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n\n      default:\n        return value + '';\n    }\n  },\n  round: function (value, precision) {\n    return precision ? Math.round(value * (precision = Math.pow(10, precision))) / precision : Math.round(value);\n  },\n  precision: function (value, precision) {\n    return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n  },\n  prefix: function (value, precision) {\n    var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', 'µ', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function (d, i) {\n      var k = Math.pow(10, Math.abs(8 - i) * 3);\n      return {\n        scale: i > 8 ? function (d) {\n          return d / k;\n        } : function (d) {\n          return d * k;\n        },\n        symbol: d\n      };\n    });\n    var i = 0;\n\n    if (value) {\n      if (value < 0) value *= -1;\n      if (precision) value = this.round(value, this.precision(value, precision));\n      i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n      i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n    }\n\n    return prefixes[8 + i / 3];\n  }\n};\n/*\n    Pre-compile the HTML to be used as a template.\n*/\n\nexport const template = function (html) {\n  /*\n      Must support the variation in templating syntax found here:\n      https://lodash.com/docs#template\n  */\n  var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n  return function (data) {\n    data = data || {};\n    return html.replace(regex, function (match) {\n      var args = Array.from(arguments);\n      var attr = args.slice(1, 4).find(function (_attr) {\n        return !!_attr;\n      });\n      var attrArray = attr.split('.');\n      var value = data[attrArray.shift()];\n\n      while (value !== undefined && attrArray.length) {\n        value = value[attrArray.shift()];\n      }\n\n      return value !== undefined ? value : '';\n    });\n  };\n};\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\n\nexport const toggleFullScreen = function (el) {\n  var topDocument = window.top.document;\n  el = el || topDocument.body;\n\n  function prefixedResult(el, prop) {\n    var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n\n    for (var i = 0; i < prefixes.length; i++) {\n      var prefix = prefixes[i];\n      var propName = prefix ? prefix + prop : prop.substr(0, 1).toLowerCase() + prop.substr(1);\n\n      if (el[propName] !== undefined) {\n        return isFunction(el[propName]) ? el[propName]() : el[propName];\n      }\n    }\n  }\n\n  if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n    prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n    prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n  } else {\n    prefixedResult(el, 'RequestFullscreen') || // Spec.\n    prefixedResult(el, 'RequestFullScreen'); // Firefox\n  }\n}; // Deprecated\n// Copy all the properties to the first argument from the following arguments.\n// All the properties will be overwritten by the properties from the following\n// arguments. Inherited properties are ignored.\n\nexport const mixin = _.assign; // Deprecated\n// Copy all properties to the first argument from the following\n// arguments only in case if they don't exists in the first argument.\n// All the function propererties in the first argument will get\n// additional property base pointing to the extenders same named\n// property function's call method.\n\nexport const supplement = _.defaults; // Same as `mixin()` but deep version.\n\nexport const deepMixin = mixin; // Deprecated\n// Same as `supplement()` but deep version.\n\nexport const deepSupplement = _.defaultsDeep; // Replacements for deprecated functions\n\nexport const assign = _.assign;\nexport const defaults = _.defaults; // no better-named replacement for `deepMixin`\n\nexport const defaultsDeep = _.defaultsDeep; // Lodash 3 vs 4 incompatible\n\nexport const invoke = _.invokeMap || _.invoke;\nexport const sortedIndex = _.sortedIndexBy || _.sortedIndex;\nexport const uniq = _.uniqBy || _.uniq;\nexport const clone = _.clone;\nexport const cloneDeep = _.cloneDeep;\nexport const isEmpty = _.isEmpty;\nexport const isEqual = _.isEqual;\nexport const isFunction = _.isFunction;\nexport const isPlainObject = _.isPlainObject;\nexport const toArray = _.toArray;\nexport const debounce = _.debounce;\nexport const groupBy = _.groupBy;\nexport const sortBy = _.sortBy;\nexport const flattenDeep = _.flattenDeep;\nexport const without = _.without;\nexport const difference = _.difference;\nexport const intersection = _.intersection;\nexport const union = _.union;\nexport const has = _.has;\nexport const result = _.result;\nexport const omit = _.omit;\nexport const pick = _.pick;\nexport const bindAll = _.bindAll;\nexport const forIn = _.forIn;\nexport const camelCase = _.camelCase;\nexport const uniqueId = _.uniqueId;\nexport const merge = function () {\n  if (_.mergeWith) {\n    var args = Array.from(arguments);\n    var last = args[args.length - 1];\n    var customizer = isFunction(last) ? last : noop;\n    args.push(function (a, b) {\n      var customResult = customizer(a, b);\n\n      if (customResult !== undefined) {\n        return customResult;\n      }\n\n      if (Array.isArray(a) && !Array.isArray(b)) {\n        return b;\n      }\n    });\n    return _.mergeWith.apply(this, args);\n  }\n\n  return _.merge.apply(this, arguments);\n};\nexport const isBoolean = function (value) {\n  var toString = Object.prototype.toString;\n  return value === true || value === false || !!value && typeof value === 'object' && toString.call(value) === '[object Boolean]';\n};\nexport const isObject = function (value) {\n  return !!value && (typeof value === 'object' || typeof value === 'function');\n};\nexport const isNumber = function (value) {\n  var toString = Object.prototype.toString;\n  return typeof value === 'number' || !!value && typeof value === 'object' && toString.call(value) === '[object Number]';\n};\nexport const isString = function (value) {\n  var toString = Object.prototype.toString;\n  return typeof value === 'string' || !!value && typeof value === 'object' && toString.call(value) === '[object String]';\n};\nexport const noop = function () {};","map":{"version":3,"sources":["C:/Users/martn/Documents/New Documents 2019/Technigo codin/r-mapper v.2/r-mapper/node_modules/jointjs/src/util/util.mjs"],"names":["_","$","V","config","addClassNamePrefix","className","toString","split","map","_className","substr","classNamePrefix","length","join","removeClassNamePrefix","parseDOMJSON","json","namespace","selectors","groupSelectors","svgNamespace","svg","ns","fragment","document","createDocumentFragment","queue","pop","parentNode","siblingsDef","i","n","nodeDef","hasOwnProperty","Error","tagName","namespaceURI","node","createElementNS","wrapper","attributes","attr","style","css","baseVal","textContent","nodeSelector","selector","nodeGroups","groupSelector","Array","isArray","j","m","nodeGroup","group","push","appendChild","childrenDef","children","hashCode","str","hash","c","charCodeAt","getByPath","obj","path","delimiter","keys","key","Object","undefined","isGetSafe","setByPath","value","last","diver","unsetByPath","flattenObject","delim","stop","ret","shouldGoDeeper","flatObject","flatKey","uuid","replace","r","Math","random","v","guid","id","toKebabCase","string","toLowerCase","normalizeEvent","evt","normalizedEvent","touchEvt","originalEvent","changedTouches","property","target","useElement","correspondingUseElement","nextFrame","raf","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","lastTime","callback","currTime","Date","getTime","timeToCall","max","setTimeout","context","rest","bind","cancelFrame","caf","client","cancelAnimationFrame","webkitCancelAnimationFrame","webkitCancelRequestAnimationFrame","msCancelAnimationFrame","msCancelRequestAnimationFrame","oCancelAnimationFrame","oCancelRequestAnimationFrame","mozCancelAnimationFrame","mozCancelRequestAnimationFrame","clearTimeout","shapePerimeterConnectionPoint","linkView","view","magnet","reference","bbox","spot","scalable","rotatable","firstChild","findIntersection","paper","cells","getBBox","model","intersectionWithLineFromCenterToPoint","center","isPercentage","val","isString","slice","parseCssNumeric","restrictUnits","getUnit","validUnitExp","matches","RegExp","exec","number","parseFloat","Number","isNaN","output","unit","breakText","text","size","styles","opt","width","height","svgDocument","textSpan","textElement","append","textNode","createTextNode","opacity","display","body","separator","eol","hyphen","maxLineCount","isNumber","Infinity","words","full","lines","p","h","lineHeight","l","len","word","isEol","indexOf","eolWords","jl","splice","filter","data","getComputedTextLength","partition","substring","hyphenIndex","search","lastL","heightValue","floor","ellipsis","lastLine","k","lastLineWithOmission","lastChar","separatorChar","match","removeChild","sanitizeHTML","html","parseHTML","find","each","currentNode","currentAttribute","attrName","name","attrValue","startsWith","removeAttr","downloadBlob","blob","fileName","navigator","msSaveBlob","url","URL","createObjectURL","link","createElement","href","download","click","revokeObjectURL","downloadDataUri","dataUri","dataUriToBlob","decodeURIComponent","firstCommaIndex","dataTypeString","mimeString","decodedString","atob","unescape","encodeURIComponent","ia","Uint8Array","Blob","type","imageToDataUri","modernHandler","xhr","status","reader","FileReader","onload","result","onerror","readAsDataURL","response","legacyHandler","Uint8ToString","u8a","CHUNK_SZ","String","fromCharCode","apply","subarray","bytes","suffix","meta","b64encoded","btoa","XMLHttpRequest","open","addEventListener","responseType","send","getElementBBox","el","$el","element","doc","ownerDocument","clientBBox","getBoundingClientRect","strokeWidthX","strokeWidthY","ownerSVGElement","vel","x","left","pageXOffset","documentElement","offsetLeft","y","top","pageYOffset","offsetTop","sortElements","elements","comparator","$elements","placements","sortElement","nextSibling","insertBefore","prototype","sort","call","setAttributesBySelector","attrs","$element","forIn","addBack","has","addClass","omit","normalizeSides","box","isFinite","right","bottom","vertical","horizontal","timing","linear","t","quad","cubic","inout","t2","t3","exponential","pow","bounce","a","b","q","reverse","f","reflect","clamp","back","s","elastic","cos","PI","interpolate","d","object","hexColor","ca","parseInt","cb","ra","rd","ga","gd","ba","bd","g","ma","mb","u","toFixed","outline","args","tpl","margin","template","color","outerRadius","innerRadius","highlight","blur","stdDeviation","dropShadow","dx","dy","grayscale","amount","e","sepia","saturate","hueRotate","angle","invert","amount2","brightness","contrast","format","specifier","locale","currency","decimal","thousands","grouping","re","fill","align","sign","symbol","zfill","comma","precision","scale","prefix","integer","min","zcomma","negative","fullSuffix","convert","lastIndexOf","before","after","formatGroup","padding","formatString","fieldDelimiterIndex","fieldDelimiter","endPlaceholder","formattedStringArray","pieceFormattedString","formatSpec","fieldName","shift","toUpperCase","toPrecision","toExponential","round","ceil","log","LN10","prefixes","abs","regex","from","arguments","_attr","attrArray","toggleFullScreen","topDocument","prefixedResult","prop","propName","isFunction","mixin","assign","supplement","defaults","deepMixin","deepSupplement","defaultsDeep","invoke","invokeMap","sortedIndex","sortedIndexBy","uniq","uniqBy","clone","cloneDeep","isEmpty","isEqual","isPlainObject","toArray","debounce","groupBy","sortBy","flattenDeep","without","difference","intersection","union","pick","bindAll","camelCase","uniqueId","merge","mergeWith","customizer","noop","customResult","isBoolean","isObject"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport V from '../V/index.mjs';\nimport { config } from '../config/index.mjs';\n\nexport const addClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) !== config.classNamePrefix) {\n            _className = config.classNamePrefix + _className;\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const removeClassNamePrefix = function(className) {\n\n    if (!className) return className;\n\n    return className.toString().split(' ').map(function(_className) {\n\n        if (_className.substr(0, config.classNamePrefix.length) === config.classNamePrefix) {\n            _className = _className.substr(config.classNamePrefix.length);\n        }\n\n        return _className;\n\n    }).join(' ');\n};\n\nexport const parseDOMJSON = function(json, namespace) {\n\n    var selectors = {};\n    var groupSelectors = {};\n    var svgNamespace = V.namespace.svg;\n\n    var ns = namespace || svgNamespace;\n    var fragment = document.createDocumentFragment();\n    var queue = [json, fragment, ns];\n    while (queue.length > 0) {\n        ns = queue.pop();\n        var parentNode = queue.pop();\n        var siblingsDef = queue.pop();\n        for (var i = 0, n = siblingsDef.length; i < n; i++) {\n            var nodeDef = siblingsDef[i];\n            // TagName\n            if (!nodeDef.hasOwnProperty('tagName')) throw new Error('json-dom-parser: missing tagName');\n            var tagName = nodeDef.tagName;\n            // Namespace URI\n            if (nodeDef.hasOwnProperty('namespaceURI')) ns = nodeDef.namespaceURI;\n            var node = document.createElementNS(ns, tagName);\n            var svg = (ns === svgNamespace);\n\n            var wrapper = (svg) ? V : $;\n            // Attributes\n            var attributes = nodeDef.attributes;\n            if (attributes) wrapper(node).attr(attributes);\n            // Style\n            var style = nodeDef.style;\n            if (style) $(node).css(style);\n            // ClassName\n            if (nodeDef.hasOwnProperty('className')) {\n                var className = nodeDef.className;\n                if (svg) {\n                    node.className.baseVal = className;\n                } else {\n                    node.className = className;\n                }\n            }\n            // TextContent\n            if (nodeDef.hasOwnProperty('textContent')) {\n                node.textContent = nodeDef.textContent;\n            }\n            // Selector\n            if (nodeDef.hasOwnProperty('selector')) {\n                var nodeSelector = nodeDef.selector;\n                if (selectors[nodeSelector]) throw new Error('json-dom-parser: selector must be unique');\n                selectors[nodeSelector] = node;\n                wrapper(node).attr('joint-selector', nodeSelector);\n            }\n            // Groups\n            if (nodeDef.hasOwnProperty('groupSelector')) {\n                var nodeGroups = nodeDef.groupSelector;\n                if (!Array.isArray(nodeGroups)) nodeGroups = [nodeGroups];\n                for (var j = 0, m = nodeGroups.length; j < m; j++) {\n                    var nodeGroup = nodeGroups[j];\n                    var group = groupSelectors[nodeGroup];\n                    if (!group) group = groupSelectors[nodeGroup] = [];\n                    group.push(node);\n                }\n            }\n            parentNode.appendChild(node);\n            // Children\n            var childrenDef = nodeDef.children;\n            if (Array.isArray(childrenDef)) queue.push(childrenDef, node, ns);\n        }\n    }\n    return {\n        fragment: fragment,\n        selectors: selectors,\n        groupSelectors: groupSelectors\n    };\n};\n\n// Return a simple hash code from a string. See http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/.\nexport const hashCode = function(str) {\n\n    let hash = 0;\n    if (str.length === 0) return hash;\n    for (let i = 0; i < str.length; i++) {\n        const c = str.charCodeAt(i);\n        hash = ((hash << 5) - hash) + c;\n        hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n};\n\nexport const getByPath = function(obj, path, delimiter) {\n\n    var keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    var key;\n    var i = 0;\n    var length = keys.length;\n    while (i < length) {\n        key = keys[i++];\n        if (Object(obj) === obj && key in obj) {\n            obj = obj[key];\n        } else {\n            return undefined;\n        }\n    }\n    return obj;\n};\n\nconst isGetSafe = function(obj, key) {\n    // Prevent prototype pollution\n    // https://snyk.io/vuln/SNYK-JS-JSON8MERGEPATCH-1038399\n    if (key === 'constructor' && typeof obj[key] === 'function') {\n        return false;\n    }\n    if (key === '__proto__') {\n        return false;\n    }\n    return true;\n};\n\nexport const setByPath = function(obj, path, value, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        // diver creates an empty object if there is no nested object under such a key.\n        // This means that one can populate an empty nested object with setByPath().\n        diver = value || (diver[key] = {});\n    }\n\n    diver[keys[last]] = value;\n\n    return obj;\n};\n\nexport const unsetByPath = function(obj, path, delimiter) {\n\n    const keys = Array.isArray(path) ? path : path.split(delimiter || '/');\n    const last = keys.length - 1;\n    let diver = obj;\n    let i = 0;\n\n    for (; i < last; i++) {\n        const key = keys[i];\n        if (!isGetSafe(diver, key)) return obj;\n        const value = diver[key];\n        if (!value) return obj;\n        diver = value;\n    }\n\n    delete diver[keys[last]];\n\n    return obj;\n};\n\nexport const flattenObject = function(obj, delim, stop) {\n\n    delim = delim || '/';\n    var ret = {};\n\n    for (var key in obj) {\n\n        if (!obj.hasOwnProperty(key)) continue;\n\n        var shouldGoDeeper = typeof obj[key] === 'object';\n        if (shouldGoDeeper && stop && stop(obj[key])) {\n            shouldGoDeeper = false;\n        }\n\n        if (shouldGoDeeper) {\n\n            var flatObject = flattenObject(obj[key], delim, stop);\n\n            for (var flatKey in flatObject) {\n                if (!flatObject.hasOwnProperty(flatKey)) continue;\n                ret[key + delim + flatKey] = flatObject[flatKey];\n            }\n\n        } else {\n\n            ret[key] = obj[key];\n        }\n    }\n\n    return ret;\n};\n\nexport const uuid = function() {\n\n    // credit: http://stackoverflow.com/posts/2117523/revisions\n\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (Math.random() * 16) | 0;\n        var v = (c === 'x') ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n};\n\n// Generate global unique id for obj and store it as a property of the object.\nexport const guid = function(obj) {\n\n    guid.id = guid.id || 1;\n    obj.id = (obj.id === undefined ? 'j_' + guid.id++ : obj.id);\n    return obj.id;\n};\n\nexport const toKebabCase = function(string) {\n\n    return string.replace(/[A-Z]/g, '-$&').toLowerCase();\n};\n\nexport const normalizeEvent = function(evt) {\n\n    var normalizedEvent = evt;\n    var touchEvt = evt.originalEvent && evt.originalEvent.changedTouches && evt.originalEvent.changedTouches[0];\n    if (touchEvt) {\n        for (var property in evt) {\n            // copy all the properties from the input event that are not\n            // defined on the touch event (functions included).\n            if (touchEvt[property] === undefined) {\n                touchEvt[property] = evt[property];\n            }\n        }\n        normalizedEvent = touchEvt;\n    }\n\n    // IE: evt.target could be set to SVGElementInstance for SVGUseElement\n    var target = normalizedEvent.target;\n    if (target) {\n        var useElement = target.correspondingUseElement;\n        if (useElement) normalizedEvent.target = useElement;\n    }\n\n    return normalizedEvent;\n};\n\nexport const nextFrame = (function() {\n\n    var raf;\n\n    if (typeof window !== 'undefined') {\n\n        raf = window.requestAnimationFrame ||\n            window.webkitRequestAnimationFrame ||\n            window.mozRequestAnimationFrame ||\n            window.oRequestAnimationFrame ||\n            window.msRequestAnimationFrame;\n    }\n\n    if (!raf) {\n\n        var lastTime = 0;\n\n        raf = function(callback) {\n\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = setTimeout(function() {\n                callback(currTime + timeToCall);\n            }, timeToCall);\n\n            lastTime = currTime + timeToCall;\n\n            return id;\n        };\n    }\n\n    return function(callback, context, ...rest) {\n        return (context !== undefined)\n            ? raf(callback.bind(context, ...rest))\n            : raf(callback);\n    };\n\n})();\n\nexport const cancelFrame = (function() {\n\n    var caf;\n    var client = typeof window != 'undefined';\n\n    if (client) {\n\n        caf = window.cancelAnimationFrame ||\n            window.webkitCancelAnimationFrame ||\n            window.webkitCancelRequestAnimationFrame ||\n            window.msCancelAnimationFrame ||\n            window.msCancelRequestAnimationFrame ||\n            window.oCancelAnimationFrame ||\n            window.oCancelRequestAnimationFrame ||\n            window.mozCancelAnimationFrame ||\n            window.mozCancelRequestAnimationFrame;\n    }\n\n    caf = caf || clearTimeout;\n\n    return client ? caf.bind(window) : caf;\n\n})();\n\n/**\n * @deprecated\n */\nexport const shapePerimeterConnectionPoint = function(linkView, view, magnet, reference) {\n\n    var bbox;\n    var spot;\n\n    if (!magnet) {\n\n        // There is no magnet, try to make the best guess what is the\n        // wrapping SVG element. This is because we want this \"smart\"\n        // connection points to work out of the box without the\n        // programmer to put magnet marks to any of the subelements.\n        // For example, we want the function to work on basic.Path elements\n        // without any special treatment of such elements.\n        // The code below guesses the wrapping element based on\n        // one simple assumption. The wrapping elemnet is the\n        // first child of the scalable group if such a group exists\n        // or the first child of the rotatable group if not.\n        // This makese sense because usually the wrapping element\n        // is below any other sub element in the shapes.\n        var scalable = view.$('.scalable')[0];\n        var rotatable = view.$('.rotatable')[0];\n\n        if (scalable && scalable.firstChild) {\n\n            magnet = scalable.firstChild;\n\n        } else if (rotatable && rotatable.firstChild) {\n\n            magnet = rotatable.firstChild;\n        }\n    }\n\n    if (magnet) {\n\n        spot = V(magnet).findIntersection(reference, linkView.paper.cells);\n        if (!spot) {\n            bbox = V(magnet).getBBox({ target: linkView.paper.cells });\n        }\n\n    } else {\n\n        bbox = view.model.getBBox();\n        spot = bbox.intersectionWithLineFromCenterToPoint(reference);\n    }\n    return spot || bbox.center();\n};\n\nexport const isPercentage = function(val) {\n\n    return isString(val) && val.slice(-1) === '%';\n};\n\nexport const parseCssNumeric = function(val, restrictUnits) {\n\n    function getUnit(validUnitExp) {\n\n        // one or more numbers, followed by\n        // any number of (\n        //  `.`, followed by\n        //  one or more numbers\n        // ), followed by\n        // `validUnitExp`, followed by\n        // end of string\n        var matches = new RegExp('(?:\\\\d+(?:\\\\.\\\\d+)*)(' + validUnitExp + ')$').exec(val);\n\n        if (!matches) return null;\n        return matches[1];\n    }\n\n    var number = parseFloat(val);\n\n    // if `val` cannot be parsed as a number, return `null`\n    if (Number.isNaN(number)) return null;\n\n    // else: we know `output.value`\n    var output = {};\n    output.value = number;\n\n    // determine the unit\n    var validUnitExp;\n    if (restrictUnits == null) {\n        // no restriction\n        // accept any unit, as well as no unit\n        validUnitExp = '[A-Za-z]*';\n\n    } else if (Array.isArray(restrictUnits)) {\n        // if this is an empty array, top restriction - return `null`\n        if (restrictUnits.length === 0) return null;\n\n        // else: restriction - an array of valid unit strings\n        validUnitExp = restrictUnits.join('|');\n\n    } else if (isString(restrictUnits)) {\n        // restriction - a single valid unit string\n        validUnitExp = restrictUnits;\n    }\n    var unit = getUnit(validUnitExp);\n\n    // if we found no matches for `restrictUnits`, return `null`\n    if (unit === null) return null;\n\n    // else: we know the unit\n    output.unit = unit;\n    return output;\n};\n\nexport const breakText = function(text, size, styles = {}, opt = {}) {\n\n    var width = size.width;\n    var height = size.height;\n\n    var svgDocument = opt.svgDocument || V('svg').node;\n    var textSpan = V('tspan').node;\n    var textElement = V('text').attr(styles).append(textSpan).node;\n    var textNode = document.createTextNode('');\n\n    // Prevent flickering\n    textElement.style.opacity = 0;\n    // Prevent FF from throwing an uncaught exception when `getBBox()`\n    // called on element that is not in the render tree (is not measurable).\n    // <tspan>.getComputedTextLength() returns always 0 in this case.\n    // Note that the `textElement` resp. `textSpan` can become hidden\n    // when it's appended to the DOM and a `display: none` CSS stylesheet\n    // rule gets applied.\n    textElement.style.display = 'block';\n    textSpan.style.display = 'block';\n\n    textSpan.appendChild(textNode);\n    svgDocument.appendChild(textElement); // lgtm [js/xss-through-dom]\n\n    if (!opt.svgDocument) {\n\n        document.body.appendChild(svgDocument);\n    }\n\n    var separator = opt.separator || ' ';\n    var eol = opt.eol || '\\n';\n    var hyphen = opt.hyphen ? new RegExp(opt.hyphen) : /[^\\w\\d]/;\n    var maxLineCount = opt.maxLineCount;\n    if (!isNumber(maxLineCount)) maxLineCount = Infinity;\n\n    var words = text.split(separator);\n    var full = [];\n    var lines = [];\n    var p, h;\n    var lineHeight;\n\n    for (var i = 0, l = 0, len = words.length; i < len; i++) {\n\n        var word = words[i];\n\n        if (!word) continue;\n\n        var isEol = false;\n        if (eol && word.indexOf(eol) >= 0) {\n            // word contains end-of-line character\n            if (word.length > 1) {\n                // separate word and continue cycle\n                var eolWords = word.split(eol);\n                for (var j = 0, jl = eolWords.length - 1; j < jl; j++) {\n                    eolWords.splice(2 * j + 1, 0, eol);\n                }\n                words.splice(i, 1, ...eolWords.filter(word => word !== ''));\n                i--;\n                len = words.length;\n                continue;\n            } else {\n                // creates a new line\n                lines[++l] = '';\n                isEol = true;\n            }\n        }\n\n        if (!isEol) {\n            textNode.data = lines[l] ? lines[l] + ' ' + word : word;\n\n            if (textSpan.getComputedTextLength() <= width) {\n\n                // the current line fits\n                lines[l] = textNode.data;\n\n                if (p || h) {\n                // We were partitioning. Put rest of the word onto next line\n                    full[l++] = true;\n\n                    // cancel partitioning and splitting by hyphens\n                    p = 0;\n                    h = 0;\n                }\n\n            } else {\n\n                if (!lines[l] || p) {\n\n                    var partition = !!p;\n\n                    p = word.length - 1;\n\n                    if (partition || !p) {\n\n                        // word has only one character.\n                        if (!p) {\n\n                            if (!lines[l]) {\n\n                                // we won't fit this text within our rect\n                                lines = [];\n\n                                break;\n                            }\n\n                            // partitioning didn't help on the non-empty line\n                            // try again, but this time start with a new line\n\n                            // cancel partitions created\n                            words.splice(i, 2, word + words[i + 1]);\n\n                            // adjust word length\n                            len--;\n\n                            full[l++] = true;\n                            i--;\n\n                            continue;\n                        }\n\n                        // move last letter to the beginning of the next word\n                        words[i] = word.substring(0, p);\n                        words[i + 1] = word.substring(p) + words[i + 1];\n\n                    } else {\n\n                        if (h) {\n                        // cancel splitting and put the words together again\n                            words.splice(i, 2, words[i] + words[i + 1]);\n                            h = 0;\n                        } else {\n                            var hyphenIndex = word.search(hyphen);\n                            if (hyphenIndex > -1 && hyphenIndex !== word.length - 1 && hyphenIndex !== 0) {\n                                h = hyphenIndex + 1;\n                                p = 0;\n                            }\n\n                            // We initiate partitioning or splitting\n                            // split the long word into two words\n                            words.splice(i, 1, word.substring(0, h || p), word.substring(h|| p));\n                            // adjust words length\n                            len++;\n\n                        }\n\n                        if (l && !full[l - 1]) {\n                        // if the previous line is not full, try to fit max part of\n                        // the current word there\n                            l--;\n                        }\n                    }\n\n                    i--;\n\n                    continue;\n                }\n\n                l++;\n                i--;\n            }\n        }\n        var lastL = null;\n\n        if (lines.length > maxLineCount) {\n\n            lastL = maxLineCount - 1;\n\n        } else if (height !== undefined) {\n\n            // if size.height is defined we have to check whether the height of the entire\n            // text exceeds the rect height\n\n            if (lineHeight === undefined) {\n\n                var heightValue;\n\n                // use the same defaults as in V.prototype.text\n                if (styles.lineHeight === 'auto') {\n                    heightValue = { value: 1.5, unit: 'em' };\n                } else {\n                    heightValue = parseCssNumeric(styles.lineHeight, ['em']) || { value: 1, unit: 'em' };\n                }\n\n                lineHeight = heightValue.value;\n                if (heightValue.unit === 'em') {\n                    lineHeight *= textElement.getBBox().height;\n                }\n            }\n\n            if (lineHeight * lines.length > height) {\n\n                // remove overflowing lines\n                lastL = Math.floor(height / lineHeight) - 1;\n            }\n        }\n\n        if (lastL !== null) {\n\n            lines.splice(lastL + 1);\n\n            // add ellipsis\n            var ellipsis = opt.ellipsis;\n            if (!ellipsis || lastL < 0) break;\n            if (typeof ellipsis !== 'string') ellipsis = '\\u2026';\n\n            var lastLine = lines[lastL];\n            if (!lastLine && !isEol) break;\n            var k = lastLine.length;\n            var lastLineWithOmission, lastChar, separatorChar;\n            do {\n                lastChar = lastLine[k];\n                lastLineWithOmission = lastLine.substring(0, k);\n                if (!lastChar) {\n                    separatorChar = (typeof separator === 'string') ? separator : ' ';\n                    lastLineWithOmission += separatorChar;\n                } else if (lastChar.match(separator)) {\n                    lastLineWithOmission += lastChar;\n                }\n                lastLineWithOmission += ellipsis;\n                textNode.data = lastLineWithOmission;\n                if (textSpan.getComputedTextLength() <= width) {\n                    lines[lastL] = lastLineWithOmission;\n                    break;\n                }\n                k--;\n            } while (k >= 0);\n            break;\n        }\n    }\n\n    if (opt.svgDocument) {\n\n        // svg document was provided, remove the text element only\n        svgDocument.removeChild(textElement);\n\n    } else {\n\n        // clean svg document\n        document.body.removeChild(svgDocument);\n    }\n\n    return lines.join(eol);\n};\n\n// Sanitize HTML\n// Based on https://gist.github.com/ufologist/5a0da51b2b9ef1b861c30254172ac3c9\n// Parses a string into an array of DOM nodes.\n// Then outputs it back as a string.\nexport const sanitizeHTML = function(html) {\n\n    // Ignores tags that are invalid inside a <div> tag (e.g. <body>, <head>)\n\n    // If documentContext (second parameter) is not specified or given as `null` or `undefined`, a new document is used.\n    // Inline events will not execute when the HTML is parsed; this includes, for example, sending GET requests for images.\n\n    // If keepScripts (last parameter) is `false`, scripts are not executed.\n    var output = $($.parseHTML('<div>' + html + '</div>', null, false));\n\n    output.find('*').each(function() { // for all nodes\n        var currentNode = this;\n\n        $.each(currentNode.attributes, function() { // for all attributes in each node\n            var currentAttribute = this;\n\n            var attrName = currentAttribute.name;\n            var attrValue = currentAttribute.value;\n\n            // Remove attribute names that start with \"on\" (e.g. onload, onerror...).\n            // Remove attribute values that start with \"javascript:\" pseudo protocol (e.g. `href=\"javascript:alert(1)\"`).\n            if (attrName.startsWith('on') || attrValue.startsWith('javascript:') || attrValue.startsWith('data:') || attrValue.startsWith('vbscript:')) {\n                $(currentNode).removeAttr(attrName);\n            }\n        });\n    });\n\n    return output.html();\n};\n\n// Download `blob` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadBlob = function(blob, fileName) {\n\n    if (window.navigator.msSaveBlob) { // requires IE 10+\n        // pulls up a save dialog\n        window.navigator.msSaveBlob(blob, fileName);\n\n    } else { // other browsers\n        // downloads directly in Chrome and Safari\n\n        // presents a save/open dialog in Firefox\n        // Firefox bug: `from` field in save dialog always shows `from:blob:`\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=1053327\n\n        var url = window.URL.createObjectURL(blob);\n        var link = document.createElement('a');\n\n        link.href = url;\n        link.download = fileName;\n        document.body.appendChild(link);\n\n        link.click();\n\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url); // mark the url for garbage collection\n    }\n};\n\n// Download `dataUri` as file with `fileName`.\n// Does not work in IE9.\nexport const downloadDataUri = function(dataUri, fileName) {\n\n    const blob = dataUriToBlob(dataUri);\n    downloadBlob(blob, fileName);\n};\n\n// Convert an uri-encoded data component (possibly also base64-encoded) to a blob.\nexport const dataUriToBlob = function(dataUri) {\n\n    // first, make sure there are no newlines in the data uri\n    dataUri = dataUri.replace(/\\s/g, '');\n    dataUri = decodeURIComponent(dataUri);\n\n    var firstCommaIndex = dataUri.indexOf(','); // split dataUri as `dataTypeString`,`data`\n\n    var dataTypeString = dataUri.slice(0, firstCommaIndex); // e.g. 'data:image/jpeg;base64'\n    var mimeString = dataTypeString.split(':')[1].split(';')[0]; // e.g. 'image/jpeg'\n\n    var data = dataUri.slice(firstCommaIndex + 1);\n    var decodedString;\n    if (dataTypeString.indexOf('base64') >= 0) { // data may be encoded in base64\n        decodedString = atob(data); // decode data\n    } else {\n        // convert the decoded string to UTF-8\n        decodedString = unescape(encodeURIComponent(data));\n    }\n    // write the bytes of the string to a typed array\n    var ia = new Uint8Array(decodedString.length);\n    for (var i = 0; i < decodedString.length; i++) {\n        ia[i] = decodedString.charCodeAt(i);\n    }\n\n    return new Blob([ia], { type: mimeString }); // return the typed array as Blob\n};\n\n// Read an image at `url` and return it as base64-encoded data uri.\n// The mime type of the image is inferred from the `url` file extension.\n// If data uri is provided as `url`, it is returned back unchanged.\n// `callback` is a method with `err` as first argument and `dataUri` as second argument.\n// Works with IE9.\nexport const imageToDataUri = function(url, callback) {\n\n    if (!url || url.substr(0, 'data:'.length) === 'data:') {\n        // No need to convert to data uri if it is already in data uri.\n\n        // This not only convenient but desired. For example,\n        // IE throws a security error if data:image/svg+xml is used to render\n        // an image to the canvas and an attempt is made to read out data uri.\n        // Now if our image is already in data uri, there is no need to render it to the canvas\n        // and so we can bypass this error.\n\n        // Keep the async nature of the function.\n        return setTimeout(function() {\n            callback(null, url);\n        }, 0);\n    }\n\n    // chrome, IE10+\n    var modernHandler = function(xhr, callback) {\n\n        if (xhr.status === 200) {\n\n            var reader = new FileReader();\n\n            reader.onload = function(evt) {\n                var dataUri = evt.target.result;\n                callback(null, dataUri);\n            };\n\n            reader.onerror = function() {\n                callback(new Error('Failed to load image ' + url));\n            };\n\n            reader.readAsDataURL(xhr.response);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var legacyHandler = function(xhr, callback) {\n\n        var Uint8ToString = function(u8a) {\n            var CHUNK_SZ = 0x8000;\n            var c = [];\n            for (var i = 0; i < u8a.length; i += CHUNK_SZ) {\n                c.push(String.fromCharCode.apply(null, u8a.subarray(i, i + CHUNK_SZ)));\n            }\n            return c.join('');\n        };\n\n        if (xhr.status === 200) {\n\n            var bytes = new Uint8Array(xhr.response);\n\n            var suffix = (url.split('.').pop()) || 'png';\n            var map = {\n                'svg': 'svg+xml'\n            };\n            var meta = 'data:image/' + (map[suffix] || suffix) + ';base64,';\n            var b64encoded = meta + btoa(Uint8ToString(bytes));\n            callback(null, b64encoded);\n        } else {\n            callback(new Error('Failed to load image ' + url));\n        }\n    };\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.open('GET', url, true);\n    xhr.addEventListener('error', function() {\n        callback(new Error('Failed to load image ' + url));\n    });\n\n    xhr.responseType = window.FileReader ? 'blob' : 'arraybuffer';\n\n    xhr.addEventListener('load', function() {\n        if (window.FileReader) {\n            modernHandler(xhr, callback);\n        } else {\n            legacyHandler(xhr, callback);\n        }\n    });\n\n    xhr.send();\n};\n\nexport const getElementBBox = function(el) {\n\n    var $el = $(el);\n    if ($el.length === 0) {\n        throw new Error('Element not found');\n    }\n\n    var element = $el[0];\n    var doc = element.ownerDocument;\n    var clientBBox = element.getBoundingClientRect();\n\n    var strokeWidthX = 0;\n    var strokeWidthY = 0;\n\n    // Firefox correction\n    if (element.ownerSVGElement) {\n\n        var vel = V(element);\n        var bbox = vel.getBBox({ target: vel.svg() });\n\n        // if FF getBoundingClientRect includes stroke-width, getBBox doesn't.\n        // To unify this across all browsers we need to adjust the final bBox with `stroke-width` value.\n        strokeWidthX = (clientBBox.width - bbox.width);\n        strokeWidthY = (clientBBox.height - bbox.height);\n    }\n\n    return {\n        x: clientBBox.left + window.pageXOffset - doc.documentElement.offsetLeft + strokeWidthX / 2,\n        y: clientBBox.top + window.pageYOffset - doc.documentElement.offsetTop + strokeWidthY / 2,\n        width: clientBBox.width - strokeWidthX,\n        height: clientBBox.height - strokeWidthY\n    };\n};\n\n\n// Highly inspired by the jquery.sortElements plugin by Padolsey.\n// See http://james.padolsey.com/javascript/sorting-elements-with-jquery/.\nexport const sortElements = function(elements, comparator) {\n\n    var $elements = $(elements);\n    var placements = $elements.map(function() {\n\n        var sortElement = this;\n        var parentNode = sortElement.parentNode;\n        // Since the element itself will change position, we have\n        // to have some way of storing it's original position in\n        // the DOM. The easiest way is to have a 'flag' node:\n        var nextSibling = parentNode.insertBefore(document.createTextNode(''), sortElement.nextSibling);\n\n        return function() {\n\n            if (parentNode === this) {\n                throw new Error('You can\\'t sort elements if any one is a descendant of another.');\n            }\n\n            // Insert before flag:\n            parentNode.insertBefore(this, nextSibling);\n            // Remove flag:\n            parentNode.removeChild(nextSibling);\n        };\n    });\n\n    return Array.prototype.sort.call($elements, comparator).each(function(i) {\n        placements[i].call(this);\n    });\n};\n\n// Sets attributes on the given element and its descendants based on the selector.\n// `attrs` object: { [SELECTOR1]: { attrs1 }, [SELECTOR2]: { attrs2}, ... } e.g. { 'input': { color : 'red' }}\nexport const setAttributesBySelector = function(element, attrs) {\n\n    var $element = $(element);\n\n    forIn(attrs, function(attrs, selector) {\n        var $elements = $element.find(selector).addBack().filter(selector);\n        // Make a special case for setting classes.\n        // We do not want to overwrite any existing class.\n        if (has(attrs, 'class')) {\n            $elements.addClass(attrs['class']);\n            attrs = omit(attrs, 'class');\n        }\n        $elements.attr(attrs);\n    });\n};\n\n// Return a new object with all four sides (top, right, bottom, left) in it.\n// Value of each side is taken from the given argument (either number or object).\n// Default value for a side is 0.\n// Examples:\n// normalizeSides(5) --> { top: 5, right: 5, bottom: 5, left: 5 }\n// normalizeSides({ horizontal: 5 }) --> { top: 0, right: 5, bottom: 0, left: 5 }\n// normalizeSides({ left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 10, left: 5 }) --> { top: 0, right: 10, bottom: 0, left: 5 }\n// normalizeSides({ horizontal: 0, left: 5 }) --> { top: 0, right: 0, bottom: 0, left: 5 }\nexport const normalizeSides = function(box) {\n\n    if (Object(box) !== box) { // `box` is not an object\n        var val = 0; // `val` left as 0 if `box` cannot be understood as finite number\n        if (isFinite(box)) val = +box; // actually also accepts string numbers (e.g. '100')\n\n        return { top: val, right: val, bottom: val, left: val };\n    }\n\n    // `box` is an object\n    var top, right, bottom, left;\n    top = right = bottom = left = 0;\n\n    if (isFinite(box.vertical)) top = bottom = +box.vertical;\n    if (isFinite(box.horizontal)) right = left = +box.horizontal;\n\n    if (isFinite(box.top)) top = +box.top; // overwrite vertical\n    if (isFinite(box.right)) right = +box.right; // overwrite horizontal\n    if (isFinite(box.bottom)) bottom = +box.bottom; // overwrite vertical\n    if (isFinite(box.left)) left = +box.left; // overwrite horizontal\n\n    return { top: top, right: right, bottom: bottom, left: left };\n};\n\nexport const timing = {\n\n    linear: function(t) {\n        return t;\n    },\n\n    quad: function(t) {\n        return t * t;\n    },\n\n    cubic: function(t) {\n        return t * t * t;\n    },\n\n    inout: function(t) {\n        if (t <= 0) return 0;\n        if (t >= 1) return 1;\n        var t2 = t * t;\n        var t3 = t2 * t;\n        return 4 * (t < .5 ? t3 : 3 * (t - t2) + t3 - .75);\n    },\n\n    exponential: function(t) {\n        return Math.pow(2, 10 * (t - 1));\n    },\n\n    bounce: function(t) {\n        for (var a = 0, b = 1; 1; a += b, b /= 2) {\n            if (t >= (7 - 4 * a) / 11) {\n                var q = (11 - 6 * a - 11 * t) / 4;\n                return -q * q + b * b;\n            }\n        }\n    },\n\n    reverse: function(f) {\n        return function(t) {\n            return 1 - f(1 - t);\n        };\n    },\n\n    reflect: function(f) {\n        return function(t) {\n            return .5 * (t < .5 ? f(2 * t) : (2 - f(2 - 2 * t)));\n        };\n    },\n\n    clamp: function(f, n, x) {\n        n = n || 0;\n        x = x || 1;\n        return function(t) {\n            var r = f(t);\n            return r < n ? n : r > x ? x : r;\n        };\n    },\n\n    back: function(s) {\n        if (!s) s = 1.70158;\n        return function(t) {\n            return t * t * ((s + 1) * t - s);\n        };\n    },\n\n    elastic: function(x) {\n        if (!x) x = 1.5;\n        return function(t) {\n            return Math.pow(2, 10 * (t - 1)) * Math.cos(20 * Math.PI * x / 3 * t);\n        };\n    }\n};\n\nexport const interpolate = {\n\n    number: function(a, b) {\n        var d = b - a;\n        return function(t) {\n            return a + d * t;\n        };\n    },\n\n    object: function(a, b) {\n        var s = Object.keys(a);\n        return function(t) {\n            var i, p;\n            var r = {};\n            for (i = s.length - 1; i != -1; i--) {\n                p = s[i];\n                r[p] = a[p] + (b[p] - a[p]) * t;\n            }\n            return r;\n        };\n    },\n\n    hexColor: function(a, b) {\n\n        var ca = parseInt(a.slice(1), 16);\n        var cb = parseInt(b.slice(1), 16);\n        var ra = ca & 0x0000ff;\n        var rd = (cb & 0x0000ff) - ra;\n        var ga = ca & 0x00ff00;\n        var gd = (cb & 0x00ff00) - ga;\n        var ba = ca & 0xff0000;\n        var bd = (cb & 0xff0000) - ba;\n\n        return function(t) {\n\n            var r = (ra + rd * t) & 0x000000ff;\n            var g = (ga + gd * t) & 0x0000ff00;\n            var b = (ba + bd * t) & 0x00ff0000;\n\n            return '#' + (1 << 24 | r | g | b).toString(16).slice(1);\n        };\n    },\n\n    unit: function(a, b) {\n\n        var r = /(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;\n        var ma = r.exec(a);\n        var mb = r.exec(b);\n        var p = mb[1].indexOf('.');\n        var f = p > 0 ? mb[1].length - p - 1 : 0;\n        a = +ma[1];\n        var d = +mb[1] - a;\n        var u = ma[2];\n\n        return function(t) {\n            return (a + d * t).toFixed(f) + u;\n        };\n    }\n};\n\n// SVG filters.\n// (values in parentheses are default values)\nexport const filter = {\n\n    // `color` ... outline color ('blue')\n    // `width`... outline width (1)\n    // `opacity` ... outline opacity (1)\n    // `margin` ... gap between outline and the element (2)\n    outline: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology in=\"SourceAlpha\" result=\"morphedOuter\" operator=\"dilate\" radius=\"${outerRadius}\" /><feMorphology in=\"SourceAlpha\" result=\"morphedInner\" operator=\"dilate\" radius=\"${innerRadius}\" /><feComposite result=\"morphedOuterColored\" in=\"colored\" in2=\"morphedOuter\" operator=\"in\"/><feComposite operator=\"xor\" in=\"morphedOuterColored\" in2=\"morphedInner\" result=\"outline\"/><feMerge><feMergeNode in=\"outline\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        var margin = Number.isFinite(args.margin) ? args.margin : 2;\n        var width = Number.isFinite(args.width) ? args.width : 1;\n\n        return template(tpl)({\n            color: args.color || 'blue',\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            outerRadius: margin + width,\n            innerRadius: margin\n        });\n    },\n\n    // `color` ... color ('red')\n    // `width`... width (1)\n    // `blur` ... blur (0)\n    // `opacity` ... opacity (1)\n    highlight: function(args) {\n\n        var tpl = '<filter><feFlood flood-color=\"${color}\" flood-opacity=\"${opacity}\" result=\"colored\"/><feMorphology result=\"morphed\" in=\"SourceGraphic\" operator=\"dilate\" radius=\"${width}\"/><feComposite result=\"composed\" in=\"colored\" in2=\"morphed\" operator=\"in\"/><feGaussianBlur result=\"blured\" in=\"composed\" stdDeviation=\"${blur}\"/><feBlend in=\"SourceGraphic\" in2=\"blured\" mode=\"normal\"/></filter>';\n\n        return template(tpl)({\n            color: args.color || 'red',\n            width: Number.isFinite(args.width) ? args.width : 1,\n            blur: Number.isFinite(args.blur) ? args.blur : 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1\n        });\n    },\n\n    // `x` ... horizontal blur (2)\n    // `y` ... vertical blur (optional)\n    blur: function(args) {\n\n        var x = Number.isFinite(args.x) ? args.x : 2;\n\n        return template('<filter><feGaussianBlur stdDeviation=\"${stdDeviation}\"/></filter>')({\n            stdDeviation: Number.isFinite(args.y) ? [x, args.y] : x\n        });\n    },\n\n    // `dx` ... horizontal shift (0)\n    // `dy` ... vertical shift (0)\n    // `blur` ... blur (4)\n    // `color` ... color ('black')\n    // `opacity` ... opacity (1)\n    dropShadow: function(args) {\n\n        var tpl = 'SVGFEDropShadowElement' in window\n            ? '<filter><feDropShadow stdDeviation=\"${blur}\" dx=\"${dx}\" dy=\"${dy}\" flood-color=\"${color}\" flood-opacity=\"${opacity}\"/></filter>'\n            : '<filter><feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"${blur}\"/><feOffset dx=\"${dx}\" dy=\"${dy}\" result=\"offsetblur\"/><feFlood flood-color=\"${color}\"/><feComposite in2=\"offsetblur\" operator=\"in\"/><feComponentTransfer><feFuncA type=\"linear\" slope=\"${opacity}\"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>';\n\n        return template(tpl)({\n            dx: args.dx || 0,\n            dy: args.dy || 0,\n            opacity: Number.isFinite(args.opacity) ? args.opacity : 1,\n            color: args.color || 'black',\n            blur: Number.isFinite(args.blur) ? args.blur : 4\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely grayscale. A value of 0 leaves the input unchanged.\n    grayscale: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.2126 + 0.7874 * (1 - amount),\n            b: 0.7152 - 0.7152 * (1 - amount),\n            c: 0.0722 - 0.0722 * (1 - amount),\n            d: 0.2126 - 0.2126 * (1 - amount),\n            e: 0.7152 + 0.2848 * (1 - amount),\n            f: 0.0722 - 0.0722 * (1 - amount),\n            g: 0.2126 - 0.2126 * (1 - amount),\n            h: 0.0722 + 0.9278 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely sepia. A value of 0 leaves the input unchanged.\n    sepia: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"matrix\" values=\"${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0\"/></filter>')({\n            a: 0.393 + 0.607 * (1 - amount),\n            b: 0.769 - 0.769 * (1 - amount),\n            c: 0.189 - 0.189 * (1 - amount),\n            d: 0.349 - 0.349 * (1 - amount),\n            e: 0.686 + 0.314 * (1 - amount),\n            f: 0.168 - 0.168 * (1 - amount),\n            g: 0.272 - 0.272 * (1 - amount),\n            h: 0.534 - 0.534 * (1 - amount),\n            i: 0.131 + 0.869 * (1 - amount)\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 0 is completely un-saturated. A value of 1 (default) leaves the input unchanged.\n    saturate: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feColorMatrix type=\"saturate\" values=\"${amount}\"/></filter>')({\n            amount: 1 - amount\n        });\n    },\n\n    // `angle` ...  the number of degrees around the color circle the input samples will be adjusted (0).\n    hueRotate: function(args) {\n\n        return template('<filter><feColorMatrix type=\"hueRotate\" values=\"${angle}\"/></filter>')({\n            angle: args.angle || 0\n        });\n    },\n\n    // `amount` ... the proportion of the conversion (1). A value of 1 (default) is completely inverted. A value of 0 leaves the input unchanged.\n    invert: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncG type=\"table\" tableValues=\"${amount} ${amount2}\"/><feFuncB type=\"table\" tableValues=\"${amount} ${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: 1 - amount\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    brightness: function(args) {\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\"/><feFuncG type=\"linear\" slope=\"${amount}\"/><feFuncB type=\"linear\" slope=\"${amount}\"/></feComponentTransfer></filter>')({\n            amount: Number.isFinite(args.amount) ? args.amount : 1\n        });\n    },\n\n    // `amount` ... proportion of the conversion (1). A value of 0 will create an image that is completely black. A value of 1 (default) leaves the input unchanged.\n    contrast: function(args) {\n\n        var amount = Number.isFinite(args.amount) ? args.amount : 1;\n\n        return template('<filter><feComponentTransfer><feFuncR type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncG type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/><feFuncB type=\"linear\" slope=\"${amount}\" intercept=\"${amount2}\"/></feComponentTransfer></filter>')({\n            amount: amount,\n            amount2: .5 - amount / 2\n        });\n    }\n};\n\nexport const format = {\n\n    // Formatting numbers via the Python Format Specification Mini-language.\n    // See http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n    // Heavilly inspired by the D3.js library implementation.\n    number: function(specifier, value, locale) {\n\n        locale = locale || {\n\n            currency: ['$', ''],\n            decimal: '.',\n            thousands: ',',\n            grouping: [3]\n        };\n\n        // See Python format specification mini-language: http://docs.python.org/release/3.1.3/library/string.html#format-specification-mini-language.\n        // [[fill]align][sign][symbol][0][width][,][.precision][type]\n        var re = /(?:([^{])?([<>=^]))?([+\\- ])?([$#])?(0)?(\\d+)?(,)?(\\.-?\\d+)?([a-z%])?/i;\n\n        var match = re.exec(specifier);\n        var fill = match[1] || ' ';\n        var align = match[2] || '>';\n        var sign = match[3] || '';\n        var symbol = match[4] || '';\n        var zfill = match[5];\n        var width = +match[6];\n        var comma = match[7];\n        var precision = match[8];\n        var type = match[9];\n        var scale = 1;\n        var prefix = '';\n        var suffix = '';\n        var integer = false;\n\n        if (precision) precision = +precision.substring(1);\n\n        if (zfill || fill === '0' && align === '=') {\n            zfill = fill = '0';\n            align = '=';\n            if (comma) width -= Math.floor((width - 1) / 4);\n        }\n\n        switch (type) {\n            case 'n':\n                comma = true;\n                type = 'g';\n                break;\n            case '%':\n                scale = 100;\n                suffix = '%';\n                type = 'f';\n                break;\n            case 'p':\n                scale = 100;\n                suffix = '%';\n                type = 'r';\n                break;\n            case 'b':\n            case 'o':\n            case 'x':\n            case 'X':\n                if (symbol === '#') prefix = '0' + type.toLowerCase();\n                break;\n            case 'c':\n            case 'd':\n                integer = true;\n                precision = 0;\n                break;\n            case 's':\n                scale = -1;\n                type = 'r';\n                break;\n        }\n\n        if (symbol === '$') {\n            prefix = locale.currency[0];\n            suffix = locale.currency[1];\n        }\n\n        // If no precision is specified for `'r'`, fallback to general notation.\n        if (type == 'r' && !precision) type = 'g';\n\n        // Ensure that the requested precision is in the supported range.\n        if (precision != null) {\n            if (type == 'g') precision = Math.max(1, Math.min(21, precision));\n            else if (type == 'e' || type == 'f') precision = Math.max(0, Math.min(20, precision));\n        }\n\n        var zcomma = zfill && comma;\n\n        // Return the empty string for floats formatted as ints.\n        if (integer && (value % 1)) return '';\n\n        // Convert negative to positive, and record the sign prefix.\n        var negative = value < 0 || value === 0 && 1 / value < 0 ? (value = -value, '-') : sign;\n\n        var fullSuffix = suffix;\n\n        // Apply the scale, computing it from the value's exponent for si format.\n        // Preserve the existing suffix, if any, such as the currency symbol.\n        if (scale < 0) {\n            var unit = this.prefix(value, precision);\n            value = unit.scale(value);\n            fullSuffix = unit.symbol + suffix;\n        } else {\n            value *= scale;\n        }\n\n        // Convert to the desired precision.\n        value = this.convert(type, value, precision);\n\n        // Break the value into the integer part (before) and decimal part (after).\n        var i = value.lastIndexOf('.');\n        var before = i < 0 ? value : value.substring(0, i);\n        var after = i < 0 ? '' : locale.decimal + value.substring(i + 1);\n\n        function formatGroup(value) {\n\n            var i = value.length;\n            var t = [];\n            var j = 0;\n            var g = locale.grouping[0];\n            while (i > 0 && g > 0) {\n                t.push(value.substring(i -= g, i + g));\n                g = locale.grouping[j = (j + 1) % locale.grouping.length];\n            }\n            return t.reverse().join(locale.thousands);\n        }\n\n        // If the fill character is not `'0'`, grouping is applied before padding.\n        if (!zfill && comma && locale.grouping) {\n\n            before = formatGroup(before);\n        }\n\n        var length = prefix.length + before.length + after.length + (zcomma ? 0 : negative.length);\n        var padding = length < width ? new Array(length = width - length + 1).join(fill) : '';\n\n        // If the fill character is `'0'`, grouping is applied after padding.\n        if (zcomma) before = formatGroup(padding + before);\n\n        // Apply prefix.\n        negative += prefix;\n\n        // Rejoin integer and decimal parts.\n        value = before + after;\n\n        return (align === '<' ? negative + value + padding\n            : align === '>' ? padding + negative + value\n                : align === '^' ? padding.substring(0, length >>= 1) + negative + value + padding.substring(length)\n                    : negative + (zcomma ? value : padding + value)) + fullSuffix;\n    },\n\n    // Formatting string via the Python Format string.\n    // See https://docs.python.org/2/library/string.html#format-string-syntax)\n    string: function(formatString, value) {\n\n        var fieldDelimiterIndex;\n        var fieldDelimiter = '{';\n        var endPlaceholder = false;\n        var formattedStringArray = [];\n\n        while ((fieldDelimiterIndex = formatString.indexOf(fieldDelimiter)) !== -1) {\n\n            var pieceFormattedString, formatSpec, fieldName;\n\n            pieceFormattedString = formatString.slice(0, fieldDelimiterIndex);\n\n            if (endPlaceholder) {\n                formatSpec = pieceFormattedString.split(':');\n                fieldName = formatSpec.shift().split('.');\n                pieceFormattedString = value;\n\n                for (var i = 0; i < fieldName.length; i++)\n                    pieceFormattedString = pieceFormattedString[fieldName[i]];\n\n                if (formatSpec.length)\n                    pieceFormattedString = this.number(formatSpec, pieceFormattedString);\n            }\n\n            formattedStringArray.push(pieceFormattedString);\n\n            formatString = formatString.slice(fieldDelimiterIndex + 1);\n            endPlaceholder = !endPlaceholder;\n            fieldDelimiter = (endPlaceholder) ? '}' : '{';\n        }\n        formattedStringArray.push(formatString);\n\n        return formattedStringArray.join('');\n    },\n\n    convert: function(type, value, precision) {\n\n        switch (type) {\n            case 'b':\n                return value.toString(2);\n            case 'c':\n                return String.fromCharCode(value);\n            case 'o':\n                return value.toString(8);\n            case 'x':\n                return value.toString(16);\n            case 'X':\n                return value.toString(16).toUpperCase();\n            case 'g':\n                return value.toPrecision(precision);\n            case 'e':\n                return value.toExponential(precision);\n            case 'f':\n                return value.toFixed(precision);\n            case 'r':\n                return (value = this.round(value, this.precision(value, precision))).toFixed(Math.max(0, Math.min(20, this.precision(value * (1 + 1e-15), precision))));\n            default:\n                return value + '';\n        }\n    },\n\n    round: function(value, precision) {\n\n        return precision\n            ? Math.round(value * (precision = Math.pow(10, precision))) / precision\n            : Math.round(value);\n    },\n\n    precision: function(value, precision) {\n\n        return precision - (value ? Math.ceil(Math.log(value) / Math.LN10) : 1);\n    },\n\n    prefix: function(value, precision) {\n\n        var prefixes = ['y', 'z', 'a', 'f', 'p', 'n', 'µ', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'].map(function(d, i) {\n            var k = Math.pow(10, Math.abs(8 - i) * 3);\n            return {\n                scale: i > 8 ? function(d) {\n                    return d / k;\n                } : function(d) {\n                    return d * k;\n                },\n                symbol: d\n            };\n        });\n\n        var i = 0;\n        if (value) {\n            if (value < 0) value *= -1;\n            if (precision) value = this.round(value, this.precision(value, precision));\n            i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);\n            i = Math.max(-24, Math.min(24, Math.floor((i <= 0 ? i + 1 : i - 1) / 3) * 3));\n        }\n        return prefixes[8 + i / 3];\n    }\n};\n\n/*\n    Pre-compile the HTML to be used as a template.\n*/\nexport const template = function(html) {\n\n    /*\n        Must support the variation in templating syntax found here:\n        https://lodash.com/docs#template\n    */\n    var regex = /<%= ([^ ]+) %>|\\$\\{ ?([^{} ]+) ?\\}|\\{\\{([^{} ]+)\\}\\}/g;\n\n    return function(data) {\n\n        data = data || {};\n\n        return html.replace(regex, function(match) {\n\n            var args = Array.from(arguments);\n            var attr = args.slice(1, 4).find(function(_attr) {\n                return !!_attr;\n            });\n\n            var attrArray = attr.split('.');\n            var value = data[attrArray.shift()];\n\n            while (value !== undefined && attrArray.length) {\n                value = value[attrArray.shift()];\n            }\n\n            return value !== undefined ? value : '';\n        });\n    };\n};\n\n/**\n * @param {Element} el Element, which content is intent to display in full-screen mode, 'window.top.document.body' is default.\n */\nexport const toggleFullScreen = function(el) {\n\n    var topDocument = window.top.document;\n    el = el || topDocument.body;\n\n    function prefixedResult(el, prop) {\n\n        var prefixes = ['webkit', 'moz', 'ms', 'o', ''];\n        for (var i = 0; i < prefixes.length; i++) {\n            var prefix = prefixes[i];\n            var propName = prefix ? (prefix + prop) : (prop.substr(0, 1).toLowerCase() + prop.substr(1));\n            if (el[propName] !== undefined) {\n                return isFunction(el[propName]) ? el[propName]() : el[propName];\n            }\n        }\n    }\n\n    if (prefixedResult(topDocument, 'FullscreenElement') || prefixedResult(topDocument, 'FullScreenElement')) {\n        prefixedResult(topDocument, 'ExitFullscreen') || // Spec.\n        prefixedResult(topDocument, 'CancelFullScreen'); // Firefox\n    } else {\n        prefixedResult(el, 'RequestFullscreen') || // Spec.\n        prefixedResult(el, 'RequestFullScreen'); // Firefox\n    }\n};\n\n// Deprecated\n// Copy all the properties to the first argument from the following arguments.\n// All the properties will be overwritten by the properties from the following\n// arguments. Inherited properties are ignored.\nexport const mixin = _.assign;\n\n// Deprecated\n// Copy all properties to the first argument from the following\n// arguments only in case if they don't exists in the first argument.\n// All the function propererties in the first argument will get\n// additional property base pointing to the extenders same named\n// property function's call method.\nexport const supplement = _.defaults;\n\n// Same as `mixin()` but deep version.\nexport const deepMixin = mixin;\n\n// Deprecated\n// Same as `supplement()` but deep version.\nexport const deepSupplement = _.defaultsDeep;\n\n// Replacements for deprecated functions\nexport const assign = _.assign;\nexport const defaults = _.defaults;\n// no better-named replacement for `deepMixin`\nexport const defaultsDeep = _.defaultsDeep;\n\n// Lodash 3 vs 4 incompatible\nexport const invoke = _.invokeMap || _.invoke;\nexport const sortedIndex = _.sortedIndexBy || _.sortedIndex;\nexport const uniq = _.uniqBy || _.uniq;\n\nexport const clone = _.clone;\nexport const cloneDeep = _.cloneDeep;\nexport const isEmpty = _.isEmpty;\nexport const isEqual = _.isEqual;\nexport const isFunction = _.isFunction;\nexport const isPlainObject = _.isPlainObject;\nexport const toArray = _.toArray;\nexport const debounce = _.debounce;\nexport const groupBy = _.groupBy;\nexport const sortBy = _.sortBy;\nexport const flattenDeep = _.flattenDeep;\nexport const without = _.without;\nexport const difference = _.difference;\nexport const intersection = _.intersection;\nexport const union = _.union;\nexport const has = _.has;\nexport const result = _.result;\nexport const omit = _.omit;\nexport const pick = _.pick;\nexport const bindAll = _.bindAll;\nexport const forIn = _.forIn;\nexport const camelCase = _.camelCase;\nexport const uniqueId = _.uniqueId;\n\nexport const merge = function() {\n    if (_.mergeWith) {\n        var args = Array.from(arguments);\n        var last = args[args.length - 1];\n\n        var customizer = isFunction(last) ? last : noop;\n        args.push(function(a, b) {\n            var customResult = customizer(a, b);\n            if (customResult !== undefined) {\n                return customResult;\n            }\n\n            if (Array.isArray(a) && !Array.isArray(b)) {\n                return b;\n            }\n        });\n\n        return _.mergeWith.apply(this, args);\n    }\n    return _.merge.apply(this, arguments);\n};\n\nexport const isBoolean = function(value) {\n    var toString = Object.prototype.toString;\n    return value === true || value === false || (!!value && typeof value === 'object' && toString.call(value) === '[object Boolean]');\n};\n\nexport const isObject = function(value) {\n    return !!value && (typeof value === 'object' || typeof value === 'function');\n};\n\nexport const isNumber = function(value) {\n    var toString = Object.prototype.toString;\n    return typeof value === 'number' || (!!value && typeof value === 'object' && toString.call(value) === '[object Number]');\n};\n\nexport const isString = function(value) {\n    var toString = Object.prototype.toString;\n    return typeof value === 'string' || (!!value && typeof value === 'object' && toString.call(value) === '[object String]');\n};\n\nexport const noop = function() {\n};\n"]},"metadata":{},"sourceType":"module"}